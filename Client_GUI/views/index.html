<p>
  <button id="go" class="btn btn-success" type="button">Start</button>
</p>

<div id="debug"></div>

<link type="text/css" rel="stylesheet" href="/css/rickshaw.min.css">
<script src="/js/d3.v2.js"></script>
<script src="/js/d3.layout.min.js"></script>
<script src="/js/rickshaw.min.js"></script>

<style>
#chart_container {
        display: inline-block;
        font-family: Arial, Helvetica, sans-serif;
}
#chart {
        float: left;
}
#legend {
        background-color: #fff;
        float: left;
        margin-left: 15px;
}
#legend .label {
        background-color: #fff;
        color: #333;
        text-shadow: 0 0 0;
}
#offset_form {
        float: left;
        margin: 2em 0 0 15px;
        font-size: 13px;
}
#y_axis {
        float: left;
        width: 50px;
}
</style>

<div id="chart_container">
        <div id="y_axis"></div>
        <div id="chart"></div>
        <div id="legend"></div>
</div>

{{#extend "scripts"}}
<script>

var refreshRate = 250;


var seriesData = [ [], [], [] ];
var random = new Rickshaw.Fixtures.RandomData(150);

for (var i = 0; i < 1; i++) {
    random.addData(seriesData);
}

var palette = new Rickshaw.Color.Palette();

var graph = new Rickshaw.Graph( {
        element: document.querySelector("#chart"),
        width: 400,
        height: 200,
        min: 'auto',
        renderer: 'line',
        interpolation: 'linear',
        // series: [
        //         {
        //                 name: "Stock Price",
        //                 data: seriesData[0],
        //                 color: palette.color()
        //         },
        //         {
        //                 name: "Window[5]",
        //                 data: seriesData[1],
        //                 color: palette.color()
        //         },
        //         {
        //                 name: "Window[20]",
        //                 data: seriesData[2],
        //                 color: palette.color()
        //         }
        // ]
        series: new Rickshaw.Series.FixedDuration([{ name: 'data1' } , { name: "data2" }, { name: "data3" }], undefined, {
            timeInterval: 32400,
            maxDataPoints: 100,
            timeBase: 32400
        })
} );

var x_axis = new Rickshaw.Graph.Axis.Time( { graph: graph } );

var y_axis = new Rickshaw.Graph.Axis.Y( {
        element: document.getElementById('y_axis'),
        graph: graph,
        // tickFormat: Rickshaw.Fixtures.Number.formatBase1024KMGTP,
        tickFormat: d3.format("0.1"),
        orientation: 'left'
} );

var legend = new Rickshaw.Graph.Legend( {
        element: document.querySelector('#legend'),
        graph: graph
} );

graph.render();

setInterval( function() {
    graph.render();
}, refreshRate );
</script>

<script>
$("#go").click(function() {
    console.log("POST: /start");
    $.ajax({
        type: "POST",
        url: "/start"
    }).done(function() {
        $("#go").removeClass("disabled");
        $("#go").text("Start");
    }).fail(function(jqXHR, textStatus) {
        alert( "Something went wrong\nRequest failed: " + textStatus );
        $("#go").removeClass("disabled");
        $("#go").text("Start");
    });

    $("#go").addClass("disabled");
    $("#go").text("Processing...");
});
</script>

<script src="/socket.io/socket.io.js"></script>

<script>
  var socket = io.connect('http://localhost');
  socket.on('data', function (data) {
    // console.log(data[0].data);
    data.forEach(function(o) {
        graph.series.addData({data1: o.data*1000, data2: o.data*1000 - 100, data3: o.data*1000 + 100 });
    });
  });
</script>

{{/extend}}